
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../Testing/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.2">
    
    
      
        <title>First section - DevOps Package</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.50c56a3b.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#automation-build-server" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="DevOps Package" class="md-header__button md-logo" aria-label="DevOps Package" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DevOps Package
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              First section
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="DevOps Package" class="md-nav__button md-logo" aria-label="DevOps Package" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    DevOps Package
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Project Management
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Project Management
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ProjectManagement/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Section 1
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Version Control
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Version Control
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../VersionControl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Section 1
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Testing
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Testing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Section 1
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Automation and Build Server
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Automation and Build Server
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    First section
  </span>
  

      </a>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="automation-build-server">Automation &amp; Build Server</h1>
<p>DevOps Package</p>
<h1 id="mission-statement">Mission Statement</h1>
<p>DevOps Package</p>
<p>To significantly  __reduce the barriers to entry __ of DevOps strategies into the day-to-day workflow of Automation Studio project development\, in order to  __increase the efficiency\, quality\, and maintainability __ of the resulting applications</p>
<h1 id="contents">Contents</h1>
<p>Automation &amp; Build Server</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server0.png" /></p>
<ul>
<li>What is it?</li>
<li>Why is it important?</li>
<li>Included Template Files</li>
<li>How to Implement</li>
<li>How to use Jenkins</li>
<li>B&amp;R-Jenkins Helper Library</li>
<li>Getting Started</li>
<li>Customizing the Jenkinsfile</li>
<li>Integration with Bitbucket</li>
<li>Automated Deployment</li>
</ul>
<h1 id="what-is-it">What is it?</h1>
<p>Automation &amp; Build Server</p>
<h1 id="automation-build-server_1">Automation &amp; Build Server</h1>
<p>Definition</p>
<p>Automation Server</p>
<p>A build server is an isolated production environment where software projects are compiled and built.</p>
<p>The code is pulled directly from a source control repository prior to build.</p>
<ul>
<li>An automation server is used to automate tasks and processes.</li>
<li>The automation server monitors the source control repo. As soon as a code change is checked into the repo (or at a specific time interval)\, the automation server will automatically trigger the following:</li>
<li>Check out the latest version of the code from the source control repo</li>
<li>Compile the code on the build server</li>
<li>Initiate the automated unit/integration tests</li>
<li>Communicate the results (pass/fail) to the interested parties via email\, Teams\, Confluence\, etc</li>
<li>Initiate automated deployment</li>
<li>… and so on</li>
<li>The automation server is essentially the “puppet master” of the automations within the DevOps process</li>
</ul>
<h1 id="why-is-it-important">Why is it important?</h1>
<p>Build &amp; Automation Server</p>
<h1 id="benefits">Benefits</h1>
<p>Build &amp; Automation Server</p>
<ul>
<li>By building the project and running tests in an isolated production environment\, you will be testing against a collection of known dependencies. In other words\, you avoid the “it fails for you\, but it works on my PC” situation</li>
<li>By automating the deployment pipeline with a build server\, developers quickly receive feedback about whether their changes introduced a problem into the system</li>
<li>The sooner a problem is identified\, the easier/cheaper it is to fix</li>
<li>The build server provides a clear paper trail for what change introduced a problem</li>
<li>When used in combination with proper version control practices\, the latest version of code will always be in a releasable state</li>
<li>Since the releases are automated and not manual\, release steps are consistent and no steps are forgotten</li>
</ul>
<h1 id="target-applications">Target Applications</h1>
<p>Build &amp; Automation Server</p>
<p>x</p>
<ul>
<li>__Any and all __ applications can benefit from the incorporation of a build and automation server</li>
<li>Any steps that are triggered automatically are inherently more efficient and reliable than executing the step manually</li>
<li>These are general software development tools that will give us a strategic advantage over our competitors</li>
<li>A build and automation server is particularly useful if:</li>
<li>You are managing multiple projects<ul>
<li>The automation server will update all interested parties via email / Teams</li>
<li>The build server will automatically generate the PIP in a consistent environment\, which makes machine updates easier because only the changes will get transferred to the target</li>
</ul>
</li>
<li>The application has unit tests<ul>
<li>The automation server will run them automatically and more frequently</li>
<li>The build/automation server will allow for a clean slate testing environment</li>
<li>The build server triggers all tests\, so you have confidence that your code changes don’t impact other aspects of the code</li>
</ul>
</li>
</ul>
<h1 id="included-template-files">Included Template Files</h1>
<p>DevOps Package</p>
<p>Automation &amp; Build Server</p>
<p>The only template file provided for this topic is a template Jenkinsfile.</p>
<p>Further explanation on how to edit this Jenkinsfile according to your situation is provided <a href="slide27.xml">later on</a>.</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server1.png" /></p>
<h1 id="how-to-implement">How to Implement</h1>
<ul>
<li>How to use Jenkins</li>
<li>B&amp;R-Jenkins Helper Library</li>
<li>Getting Started</li>
<li>Customizing the Jenkinsfile</li>
<li>Integration with Bitbucket</li>
</ul>
<h1 id="how-to-use-jenkins">How to use Jenkins</h1>
<h1 id="jenkins">Jenkins</h1>
<p>Proposed Tool</p>
<p>Jenkins is a very popular\, open-source tool which provides deployment pipeline functionality</p>
<p>It can be used to automate all sorts of tasks related to building\, testing\, delivering and deploying software</p>
<p>This is the tool that B&amp;R uses for our automation server\, so the rest of this PPT will be focused on Jenkins. You are free to investigate other options as desired.</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server2.png" /></p>
<h1 id="atl-jenkins-server">ATL Jenkins Server</h1>
<p>Used by All NA Regions</p>
<ul>
<li>B&amp;R North America has a build/automation server running out of our ATL office that you can utilize as long as B&amp;R engineers are involved in your project and have credentials to your source control repository<ul>
<li>This is convenient because it means you don’t have to build up your own server right away</li>
<li>To get started with this option\, contact your B&amp;R NA representative. Note that this option is not available outside of North America</li>
</ul>
</li>
<li>Once B&amp;R is no longer actively involved in the project\, though\, you will need to create your own build/automation server setup<ul>
<li>B&amp;R does not manage customer automation servers long-term</li>
</ul>
</li>
<li>Alternatively\, you can create your own automation server setup from the get-go</li>
</ul>
<p><img alt="" src="../img/Automation%20and%20Build%20Server3.png" /></p>
<h1 id="multibranch-pipeline">Multibranch Pipeline</h1>
<p>Jenkins Project Type</p>
<ul>
<li>There are a few different project types within Jenkins\, but the one we recommend is the  <strong>Multibranch Pipeline</strong> .</li>
<li>A pipeline is a workflow defined in text-based code within a text file called “Jenkinsfile”</li>
<li>A Multibranch Pipeline project automatically creates sub-projects for every branch in the source code repository</li>
<li>If a new branch is created and pushed to the repository\, then a new sub-project in the multibranch pipeline is created and runs for that branch</li>
<li>The Jenkinsfile is committed to the source control repository\, so the pipeline itself is protected by version control</li>
<li>This also means that the developers can freely/directly add steps to the pipeline</li>
</ul>
<h1 id="use-multiple-multibranch-pipelines">Use Multiple Multibranch Pipelines</h1>
<p>Recommendation</p>
<ul>
<li>You can configure multiple Jenkins pipelines to run in series</li>
<li>Once the first pipeline completes successfully\, the next one automatically starts running\, and so on.</li>
<li>Alternatively\, since the pipelines are separated\, you can run the integration tests (which typically take longer) at a lower frequency than the unit tests. The unit tests could run every time code is committed and pushed\, but the integration test run only every 4 hours\, for example.</li>
</ul>
<p>Build\, Unit Tests</p>
<p>Integration Testing</p>
<p>(longer running tests)</p>
<p>Release Deployment</p>
<p>Machine Deployment</p>
<p>Recommendation</p>
<ul>
<li>We recommend using at least the following 3 distinct multibranch pipelines for AS project development:</li>
<li>Multibranch pipeline 1: Builds the project and runs unit tests</li>
<li>Multibranch pipeline 2: Runs integration tests</li>
<li>Multibranch pipeline 3: Handles the release deployment</li>
<li>Note: the template Jenkinsfile in this DevOps package is a starter implementation that corresponds to one single pipeline for building the project\, running unit tests\, and release deployment. Integration testing is not yet included (this will come in a future update to the DevOps package).</li>
</ul>
<p>Build\, Unit Tests</p>
<p>Integration Testing</p>
<p>(longer running tests)</p>
<p>Release Deployment</p>
<p>Machine Deployment</p>
<h1 id="br-jenkins-helper-library">B&amp;R-Jenkins Helper Library</h1>
<p>Ready-made Scripts</p>
<p>Readymade Groovy Scripts</p>
<ul>
<li>B&amp;R North America has written a helper library that includes a lot of useful functions for interacting with AS projects</li>
<li>The library contains Groovy scripts\, which are wrappers around Python scripts and general commands</li>
<li>You don’t need to edit this library at all\, but you will be using it in your Jenkinsfile</li>
<li>The functions are described on the next slides as an FYI</li>
<li>Public link to the library on GitHub: <a href="https://github.com/br-automation-com/BnR-Jenkins-Helper-Library">https://github.com/br-automation-com/BnR-Jenkins-Helper-Library</a></li>
<li>The Groovy scripts are located within the “vars” folder on the repo</li>
<li>The Python scripts that the Groovy scripts utilize are located within the “resources\scripts” folder on the repo</li>
<li>These scripts have been tested in AS4.7 and above. Prior AS versions may work\, but they are currently untested.</li>
</ul>
<p>Add to Jenkins Server</p>
<ul>
<li>To utilize this helper library on your Jenkins server\, do the following:</li>
<li>Go to “Manage Jenkins”</li>
<li>Select “System”</li>
<li>Scroll down to the “Global Pipeline Libraries” section. Click “Add”. Then:</li>
<li>Fill out a Name for the library (whatever you prefer)</li>
<li>In the “Default Version” field\, type “main”</li>
<li>Check the boxes for “Load implicitly”\, “Allow default version to be overridden”\, and “Include @Library changes in job recent changes”</li>
<li>Set the Retrieval method to “Modern SCM”</li>
<li>Set “Source Code Management” to “GitHub”</li>
<li>Fill out the credentials accordingly (or add new credentials if needed)</li>
<li>In the “Repository HTTPS URL” field\, paste this URL: <a href="https://github.com/br-automation-com/BnR-Jenkins-Helper-Library.git">https://github.com/br-automation-com/BnR-Jenkins-Helper-Library.git</a></li>
<li>In the “Library Path” field\, paste the following: ./</li>
</ul>
<p><img alt="" src="../img/Automation%20and%20Build%20Server4.png" /></p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server5.png" /></p>
<h1 id="version-info-functions">Version Info Functions</h1>
<p>B&amp;R-Jenkins Helper Library</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Function</th>
<th style="text-align: center;">Description</th>
<th style="text-align: center;">Arguments</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">Version</td>
<td style="text-align: center;">Returns full version number based on tag (e.g. 1.2.3.9004)<br /></td>
<td style="text-align: center;">workspace</td>
</tr>
<tr>
<td style="text-align: center;">ReleaseVersion</td>
<td style="text-align: center;">Returns Major.Minor.Bugfix style version number<br /></td>
<td style="text-align: center;">workspace</td>
</tr>
<tr>
<td style="text-align: center;">MajorVersionNumber</td>
<td style="text-align: center;">Returns just the Major version number</td>
<td style="text-align: center;">workspace</td>
</tr>
<tr>
<td style="text-align: center;">MinorVersionNumber</td>
<td style="text-align: center;">Returns just the Minor version number</td>
<td style="text-align: center;">workspace</td>
</tr>
<tr>
<td style="text-align: center;">BugFixVersionNumber</td>
<td style="text-align: center;">Returns just the bug version number</td>
<td style="text-align: center;">workspace</td>
</tr>
</tbody>
</table>
<p>The workspace is where Jenkins checks out the project from the repo and runs the pipeline.</p>
<p>To reference the workspace in the Jenkinsfile\, use the readymade environment variable "${WORKSPACE}"</p>
<h1 id="git-info-functions">Git Info Functions</h1>
<p>B&amp;R-Jenkins Helper Library</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Function</th>
<th style="text-align: center;">Description</th>
<th style="text-align: center;">Arguments</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">BranchName</td>
<td style="text-align: center;">Returns the name of the git branch</td>
<td style="text-align: center;">workspace</td>
</tr>
<tr>
<td style="text-align: center;">Tag</td>
<td style="text-align: center;">Returns the last tag in the branch</td>
<td style="text-align: center;">workspace</td>
</tr>
<tr>
<td style="text-align: center;">IsReleaseCandidate</td>
<td style="text-align: center;">Returns true if the branch is in the release/* branch</td>
<td style="text-align: center;">workspace</td>
</tr>
<tr>
<td style="text-align: center;">IsReleaseBranch</td>
<td style="text-align: center;">Returns true if branch is master or main</td>
<td style="text-align: center;">workspace</td>
</tr>
</tbody>
</table>
<p>The workspace is where Jenkins checks out the project from the repo and runs the pipeline.</p>
<p>To reference the workspace in the Jenkinsfile\, use the readymade environment variable "${WORKSPACE}"</p>
<h1 id="ar-helper-functions">AR Helper Functions</h1>
<p>B&amp;R-Jenkins Helper Library</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Function</th>
<th style="text-align: center;">Description</th>
<th style="text-align: center;">Arguments</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">BuildASProject</td>
<td style="text-align: center;">Builds an Automation Studio Project</td>
<td style="text-align: center;">project – path within the workspace to the project (the folder containing the .apj file). For example: "$WORKSPACE\TestProject"<br />configuration – configuration name in the AS project<br />max_warnings – the maximum number or build warnings that are allowed in order to consider the build a success. Set this to -1 to accept infinite warnings<br />buildpip – whether to build the PIP or not</td>
</tr>
<tr>
<td style="text-align: center;">BuildARsimStructure</td>
<td style="text-align: center;">Creates the ARsim structure</td>
<td style="text-align: center;">project – path within the workspace to the project (the folder containing the .apj file). For example: "$WORKSPACE\TestProject"<br />configuration – configuration name in the AS project</td>
</tr>
</tbody>
</table>
<h1 id="unit-test-functions">Unit Test Functions</h1>
<p>B&amp;R-Jenkins Helper Library</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Function</th>
<th style="text-align: center;">Description</th>
<th style="text-align: center;">Arguments</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">RunArUnitTests</td>
<td style="text-align: center;">Runs unit test configuration in ArSim</td>
<td style="text-align: center;">tests – the name of the unit tests to run. Use “all” to run all tests<br />configuration – configuration name in the AS project that contains the unit tests<br />project – path within the workspace to the project (the folder containing the .apj file). For example: "$WORKSPACE\TestProject“</td>
</tr>
<tr>
<td style="text-align: center;">ProcessArTestResults</td>
<td style="text-align: center;">Process test results xml files</td>
<td style="text-align: center;">N/A</td>
</tr>
</tbody>
</table>
<h1 id="information-sharing-functions">Information Sharing Functions</h1>
<p>B&amp;R-Jenkins Helper Library</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Function</th>
<th style="text-align: center;">Description</th>
<th style="text-align: center;">Arguments</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">UploadToGitHub</td>
<td style="text-align: center;">Uploads build artifacts to a GitHub repository</td>
<td style="text-align: center;">version – version number of the artifact<br />organization – repo organization name<br />name – repo name<br />file – filename of the artifact to upload</td>
</tr>
<tr>
<td style="text-align: center;">SendNotifications</td>
<td style="text-align: center;">Sends an email to team members</td>
<td style="text-align: center;">buildStatus – the status/result of the most recent build of the pipeline<br />recipients – list of email addresses to send the email to</td>
</tr>
</tbody>
</table>
<h1 id="getting-started">Getting Started</h1>
<p>Note: If you are utilizing the B&amp;R Jenkins server initially\, then you can skip the steps in this slide</p>
<h1 id="system-requirements">System Requirements</h1>
<p>Build and Automation Server</p>
<ul>
<li>If you are setting up your own build/automation server\, note the following system requirements:</li>
<li>Hardware requirements</li>
<li>12 GB of RAM</li>
<li>10 GB of drive space (&gt;50 GB recommended)</li>
<li>Software requirements</li>
<li>Windows 10</li>
<li>Automation Studio 4.7 or above (version must match the project)<ul>
<li>Plus all required upgrades for the project (manually installed on server)</li>
<li>Note: supporting scripts have been tested in AS4.7 and above. Prior versions may work\, but have not been checked</li>
</ul>
</li>
<li>Python ≥ 3.9<ul>
<li>Required for automated build scripts</li>
</ul>
</li>
<li>Jenkins</li>
<li>Java Development Kit</li>
</ul>
<p>Note: If you are utilizing the B&amp;R Jenkins server initially\, then you can skip the steps in this slide</p>
<h1 id="downloads-and-installation">Downloads and Installation</h1>
<p>Build and Automation Server</p>
<ul>
<li><a href="https://www.jenkins.io/download/">Jenkins Download</a></li>
<li><a href="https://adoptium.net/temurin/releases/?version=11">Java Development Kit Download</a></li>
<li><a href="https://www.python.org/downloads/">Python Download</a></li>
<li>Installation instructions for Jenkins and the JDK are located <a href="https://www.jenkins.io/doc/book/installing/windows/">here</a>.</li>
<li>Please review the video for full instructions on how to install the JDK\, Jenkins\, and make assorted configuration changes after install.</li>
<li>We recommend installing Jenkins on a server or dedicated PC</li>
<li>We recommend installing Jenkins with the “recommended plugins” option</li>
<li>And manually add the “Office 365 Connector” plugin</li>
<li>Configure Extended E-mail Notification plugin</li>
<li>Python requirements</li>
<li>pip install requests junitparser GitPython</li>
</ul>
<p><img alt="" src="../img/Automation%20and%20Build%20Server6.png" /></p>
<h1 id="creating-jenkins-agent-docker-container">Creating Jenkins Agent Docker Container</h1>
<h1 id="jenkins-agent">Jenkins Agent</h1>
<p>Build and Automation Server</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server7.png" /></p>
<p>Create a new node to run the Jenkins agent</p>
<p>Goto “Manage Jenkins”</p>
<p>Build and Automation Server</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server8.png" /></p>
<p>Create a new node to run the Jenkins agent</p>
<p>Goto “Manage Jenkins”</p>
<p>Select “Nodes” under the System Configuration</p>
<p>Build and Automation Server</p>
<p>Create a new node to run the Jenkins agent</p>
<p>Goto “Manage Jenkins”</p>
<p>Select “Nodes” under the System Configuration</p>
<p>Click the “New Node” button</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server9.png" /></p>
<p>Build and Automation Server</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server10.png" /></p>
<p>Create a new node to run the Jenkins agent</p>
<p>Goto “Manage Jenkins”</p>
<p>Select “Nodes” under the System Configuration</p>
<p>Click the “New Node” button</p>
<p>Define the name of your node and select “Permanent Agent”</p>
<p>Click “Create”</p>
<p>Build and Automation Server</p>
<p>Create a new node to run the Jenkins agent</p>
<p>Goto “Manage Jenkins”</p>
<p>Select “Nodes” under the System Configuration</p>
<p>Click the “New Node” button</p>
<p>Define the name of your node and select “Permanent Agent”</p>
<p>Click “Create”</p>
<p>Define “Remote root directory”</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server11.png" /></p>
<p>Build and Automation Server</p>
<p>Create a new node to run the Jenkins agent</p>
<p>Goto “Manage Jenkins”</p>
<p>Select “Nodes” under the System Configuration</p>
<p>Click the “New Node” button</p>
<p>Define the name of your node and select “Permanent Agent”</p>
<p>Click “Create”</p>
<p>Define “Remote root directory”</p>
<p>Define labels based on Automation Studio Version</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server12.png" /></p>
<p>Build and Automation Server</p>
<p>Create a new node to run the Jenkins agent</p>
<p>Goto “Manage Jenkins”</p>
<p>Select “Nodes” under the System Configuration</p>
<p>Click the “New Node” button</p>
<p>Define the name of your node and select “Permanent Agent”</p>
<p>Click “Create”</p>
<p>Define “Remote root directory”</p>
<p>Define labels based on Automation Studio Version</p>
<p>Change “Usage” to “Only build jobs with label expressions matching this mode”</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server13.png" /></p>
<p>Build and Automation Server</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server14.png" /></p>
<p>Create a new node to run the Jenkins agent</p>
<p>Goto “Manage Jenkins”</p>
<p>Select “Nodes” under the System Configuration</p>
<p>Click the “New Node” button</p>
<p>Define the name of your node and select “Permanent Agent”</p>
<p>Click “Create”</p>
<p>Define “Remote root directory”</p>
<p>Define labels based on Automation Studio Version</p>
<p>Change “Usage” to “Only build jobs with label expressions matching this mode”</p>
<p>Change “Launch method” to “Launch agent by connecting it to the controller”</p>
<p>Check “Use WebSocket”</p>
<p>Build and Automation Server</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server15.png" /></p>
<p>Create a new node to run the Jenkins agent</p>
<p>Goto “Manage Jenkins”</p>
<p>Select “Nodes” under the System Configuration</p>
<p>Click the “New Node” button</p>
<p>Define the name of your node and select “Permanent Agent”</p>
<p>Click “Create”</p>
<p>Define “Remote root directory”</p>
<p>Define labels based on Automation Studio Version</p>
<p>Change “Usage” to “Only build jobs with label expressions matching this mode”</p>
<p>Change “Launch method” to “Launch agent by connecting it to the controller”</p>
<p>Check “Use WebSocket”</p>
<p>Click “Save”</p>
<p>Build and Automation Server</p>
<p>Create a new node to run the Jenkins agent</p>
<p>Goto “Manage Jenkins”</p>
<p>Select “Nodes” under the System Configuration</p>
<p>Click the “New Node” button</p>
<p>Define the name of your node and select “Permanent Agent”</p>
<p>Click “Create”</p>
<p>Define “Remote root directory”</p>
<p>Define labels based on Automation Studio Version</p>
<p>Change “Usage” to “Only build jobs with label expressions matching this mode”</p>
<p>Change “Launch method” to “Launch agent by connecting it to the controller”</p>
<p>Check “Use WebSocket”</p>
<p>Click “Save”</p>
<p>Copy the secret provided</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server16.png" /></p>
<h1 id="docker-build">Docker Build</h1>
<p>Build and Automation Server</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server17.png" /></p>
<p>Create a Docker container for the agent</p>
<p>Open the Dockerfile in a text editor</p>
<p>Build and Automation Server</p>
<p>Create a Docker container for the agent</p>
<p>Open the Dockerfile in a text editor</p>
<p>Adjust the JENKINS_URL for your configuration</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server18.png" /></p>
<p>Build and Automation Server</p>
<p>Create a Docker container for the agent</p>
<p>Open the Dockerfile in a text editor</p>
<p>Adjust the JENKINS_URL for your configuration</p>
<p>Add the Jenkins secret from the node creation to JENKINS_SECRET</p>
<p>Adjust the JENKINS_AGENT_NAME with the name of the node</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server19.png" /></p>
<p>Build and Automation Server</p>
<p>Create a Docker container for the agent</p>
<p>Open the Dockerfile in a text editor</p>
<p>Adjust the JENKINS_URL for your configuration</p>
<p>Add the Jenkins secret from the node creation to JENKINS_SECRET</p>
<p>Adjust the JENKINS_AGENT_NAME with the name of the node</p>
<p>Create the Docker image</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server20.png" /></p>
<h1 id="create-jenkins-project">Create Jenkins project</h1>
<p>Note: If you are utilizing the B&amp;R Jenkins server initially\, then you can skip the steps in this slide</p>
<h1 id="create-a-multibranch-pipeline">Create a Multibranch Pipeline</h1>
<p>Jenkins</p>
<ul>
<li>Open the Jenkins server web browser</li>
<li>From the Dashboard\, click “New Item” in the top left and select “Multibranch Pipeline”</li>
<li>Fill out the configuration for this new pipeline. Required changes:</li>
<li>Add a Branch Source<ul>
<li>Fill out the corresponding fields\, which vary depending on the source type</li>
</ul>
</li>
<li>Set the Build Configuration Mode to “by Jenkinsfile” and update the script path to where you want this file to live in your repo<ul>
<li>This file is where you will define your pipeline</li>
</ul>
</li>
<li>Add the “Clean before checkout” option to the repository</li>
<li>Paste the provided template “Jenkinsfile” to the location you specified in step 3b</li>
<li>Open the “Jenkinsfile” in a text editor</li>
</ul>
<p><img alt="" src="../img/Automation%20and%20Build%20Server21.png" /></p>
<hr />
<p>Getting Started section</p>
<h1 id="overview-of-the-jenkinsfile-template">Overview of the Jenkinsfile Template</h1>
<p>Getting Started</p>
<p>The provided Jenkinsfile template accomplishes the following tasks:</p>
<p>Builds the AS project</p>
<p>Runs the unit tests</p>
<p>Creates an ARsim structure and PIP</p>
<p>Uploads the ARsim structure and PIP to GitHub\, and sends them to an MS Teams channel via a chat message</p>
<p>Sends an email with the results of the build</p>
<h1 id="customizing-the-jenkinsfile">Customizing the Jenkinsfile</h1>
<ul>
<li>Variables</li>
<li>Agent</li>
<li>Environment</li>
<li>Options</li>
<li>Stages</li>
<li>Post</li>
</ul>
<p>Starting from the template</p>
<ul>
<li>The provided template Jenkinsfile is a starting point for your pipeline definition</li>
<li>There are a few things in this file that must be adjusted for it to run properly for your system</li>
<li>The following slides identify the purpose of each section in the Jenkinsfile and any changes you must make. There are 6 main sections in the Jenkinsfile pipeline:</li>
<li><em>Variable Definitions</em>  – Defines global variables</li>
<li><em>Agent</em>  – Defines where the pipeline will run within the Jenkins environment</li>
<li><em>Environment</em>  – Defines global environment variables</li>
<li><em>Options</em>  – Configures options</li>
<li><em>Stages</em>  – Defines the steps in the pipeline. If a stage fails\, subsequent stages don’t run</li>
<li>
<p><em>Post</em>  – Always runs at the end of the pipeline\, even if a stage fails</p>
</li>
<li>
<p><strong>Variables</strong></p>
</li>
<li>Agent</li>
<li><strong>Environment</strong></li>
<li>Options</li>
<li>Stages</li>
<li>Post</li>
</ul>
<h1 id="difference-between-variables-and-environment-variables">Difference between Variables and Environment Variables</h1>
<p>Additional Context</p>
<p>Variables</p>
<p>Defined outside the pipeline\, at the top of the file</p>
<p>All variables are global</p>
<p>Environment Variables</p>
<p>Defined within an environment{} section\, either at the top level of the pipeline (for pipeline global environment variable declarations) or within a stage of the pipeline (for stage local declarations)</p>
<p>Global environment variables can also be defined in the configuration of Jenkins. In this case\, the variables are accessible to all pipelines</p>
<p>There are also some built-in environment variables that can be used throughout any Jenkinsfile (analogous to System Variables in mapp View). A full list of predefined and readily available environment variables in Jenkins is available <a href="https://www.jenkins.io/doc/book/pipeline/jenkinsfile/#using-environment-variables">here</a>.</p>
<p>The built-in workspace environment variable (${WORKSPACE}) is not available until the pipeline starts running. Therefore\, if the variable you are creating needs to reference the workspace\, you must declare it as an environment variable. In our template file\, this is why PROJECT_DIR and RELEASE_VERSION are declared as environment variables.</p>
<ul>
<li><strong>Variables</strong></li>
<li>Agent</li>
<li>Environment</li>
<li>Options</li>
<li>Stages</li>
<li>Post</li>
</ul>
<h1 id="variables">Variables</h1>
<p>Customizing the Jenkinsfile</p>
<p>Starting at the top of the Jenkinsfile\, we will begin by adjusting the global variables. The following table describes each variable. Adjust the values accordingly:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Variable Name</th>
<th style="text-align: center;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">TEAMS_CHANNEL_URL</td>
<td style="text-align: center;">Teams channel webhook URL where messages about the pipeline status will automatically be sent. For more details on how to define this, refer to the “Options” section.</td>
</tr>
<tr>
<td style="text-align: center;">CONFIG_NAME</td>
<td style="text-align: center;">Name of the configuration in the AS project that you are running through the pipeline</td>
</tr>
<tr>
<td style="text-align: center;">UNIT_TEST_CONFIG_NAME</td>
<td style="text-align: center;">Name of the unit test configuration in the AS project</td>
</tr>
<tr>
<td style="text-align: center;">REPO_NAME</td>
<td style="text-align: center;">Name of the GitHub repository. Only required if you plan to upload files to GitHub.</td>
</tr>
<tr>
<td style="text-align: center;">REPO_ORGANIZATION</td>
<td style="text-align: center;">Name of the GitHub organization. Only required if you plan to upload files to GitHub.</td>
</tr>
<tr>
<td style="text-align: center;">EMAIL_LIST</td>
<td style="text-align: center;">List of email addresses that you want to send the results to, each separated by a semicolon</td>
</tr>
</tbody>
</table>
<ul>
<li>Variables</li>
<li><strong>Agent</strong></li>
<li>Environment</li>
<li>Options</li>
<li>Stages</li>
<li>Post</li>
</ul>
<h1 id="agent">Agent</h1>
<p>Customizing the Jenkinsfile</p>
<ul>
<li>Edit the “agent” line accordingly.</li>
<li>If you are utilizing the B&amp;R Jenkins server to start\, then identify the docker container your pipeline will run in. This simply depends on the AS version of your project<ul>
<li>Example: AS_412</li>
</ul>
</li>
<li>If you have built your own Jenkins server\, then specify the <a href="https://www.jenkins.io/doc/book/using/using-agents/">agent</a> accordingly.</li>
</ul>
<p><img alt="" src="../img/Automation%20and%20Build%20Server22.png" /></p>
<ul>
<li>Variables</li>
<li>Agent</li>
<li><strong>Environment</strong></li>
<li>Options</li>
<li>Stages</li>
<li>Post</li>
</ul>
<h1 id="environment">Environment</h1>
<p>Customizing the Jenkinsfile</p>
<p>The following table describes each environment variable. Adjust the values accordingly:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Variable Name</th>
<th style="text-align: center;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">PROJECT_DIR</td>
<td style="text-align: center;">Specify the path within the repository to the AS project (the folder containing the .apj file). <br />Use \ for folder separation.<br />Example: PROJECT_DIR = "$WORKSPACE\TestProject“<br />If the project is stored in the root directory, then leave it defined as PROJECT_DIR = "$WORKSPACE"</td>
</tr>
<tr>
<td style="text-align: center;">RELEASE_VERSION</td>
<td style="text-align: center;">Holds the version number of the code in the repo. No changes required.</td>
</tr>
</tbody>
</table>
<ul>
<li>Variables</li>
<li>Agent</li>
<li>Environment</li>
<li><strong>Options</strong></li>
<li>Stages</li>
<li>Post</li>
</ul>
<h1 id="options">Options</h1>
<p>Customizing the Jenkinsfile</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server23.png" /></p>
<ul>
<li>The “options” section sets up a webhook to an MS Teams channel so that you can automatically send information to that channel. This includes:</li>
<li>Updates on when the pipeline has started / stopped</li>
<li>Whether the pipeline succeeded</li>
<li>The output files of the pipeline (by default in our template\, the output files are the zipped up ARsim structure and PIP)</li>
<li>
<p>To establish this connection\, you need to obtain your Teams channel webhook URL (see next slides) and paste it in the value for the TEAMS_CHANNEL_URL variable</p>
</li>
<li>
<p>Variables</p>
</li>
<li>Agent</li>
<li>Environment</li>
<li><strong>Options</strong></li>
<li>Stages</li>
<li>Post</li>
</ul>
<h1 id="obtaining-the-webhook-url">Obtaining the Webhook URL</h1>
<p>Microsoft Teams Connection</p>
<p>Navigate to the channel in the Team that you want to establish the connection to</p>
<p>Click the “…” button</p>
<p>Click “Connectors”</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server24.png" /></p>
<ul>
<li>Variables</li>
<li>Agent</li>
<li>Environment</li>
<li><strong>Options</strong></li>
<li>Stages</li>
<li>Post</li>
</ul>
<p>Microsoft Teams Connection</p>
<p>Navigate to the channel in the Team that you want to establish the connection to</p>
<p>Click the “…” button</p>
<p>Click “Connectors”</p>
<p>Click “Configure” for “Incoming Webhook”</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server25.png" /></p>
<ul>
<li>Variables</li>
<li>Agent</li>
<li>Environment</li>
<li><strong>Options</strong></li>
<li>Stages</li>
<li>Post</li>
</ul>
<p>Microsoft Teams Connection</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server26.png" /></p>
<p>Navigate to the channel in the Team that you want to establish the connection to</p>
<p>Click the “…” button</p>
<p>Click “Connectors”</p>
<p>Click “Configure” for “Incoming Webhook”</p>
<p>Give your webhook a name and click “Create”</p>
<ul>
<li>Variables</li>
<li>Agent</li>
<li>Environment</li>
<li><strong>Options</strong></li>
<li>Stages</li>
<li>Post</li>
</ul>
<p>Microsoft Teams Connection</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server27.png" /></p>
<p>Navigate to the channel in the Team that you want to establish the connection to</p>
<p>Click the “…” button</p>
<p>Click “Connectors”</p>
<p>Click “Configure” for “Incoming Webhook”</p>
<p>Give your webhook a name and click “Create”</p>
<p>Afterwards\, the URL you need will be populated in the field at the bottom. Copy this link and paste it at the top of the Jenkinsfile as the value of the TEAMS_CHANNEL_URL variable</p>
<ul>
<li>Variables</li>
<li>Agent</li>
<li>Environment</li>
<li>Options</li>
<li><strong>Stages</strong></li>
<li>
<p>Post</p>
</li>
<li>
<p>Update Tags</p>
</li>
<li>Build AS Project</li>
<li>Unit Tests</li>
<li>Deploy</li>
</ul>
<h1 id="stages">Stages</h1>
<p>Customizing the Jenkinsfile</p>
<ul>
<li>The next section in the pipeline is the stages.</li>
<li>This is where you define the actions that the build server will perform.</li>
<li>This is the “meat and potatoes” of the pipeline.</li>
<li>There are 4 stages set up in the template Jenkinsfile\, which we will now go through one by one:</li>
<li>Update Tags</li>
<li>Build AS Project</li>
<li>Unit Tests</li>
<li>
<p>Deploy</p>
</li>
<li>
<p>Variables</p>
</li>
<li>Agent</li>
<li>Environment</li>
<li>Options</li>
<li><strong>Stages</strong></li>
<li>
<p>Post</p>
</li>
<li>
<p><strong>Update Tags</strong></p>
</li>
<li>Build AS Project</li>
<li>Unit Tests</li>
<li>Deploy</li>
</ul>
<h1 id="stage-update-tags">Stage: Update Tags</h1>
<p>Customizing the Jenkinsfile</p>
<ul>
<li>This stage force-pulls the tags in the repository</li>
<li>Note that therefore\, at least one tag must exist in the repo</li>
<li>This information will be used later to create a version number</li>
<li>No changes necessary</li>
</ul>
<p><img alt="" src="../img/Automation%20and%20Build%20Server28.png" /></p>
<ul>
<li>Variables</li>
<li>Agent</li>
<li>Environment</li>
<li>Options</li>
<li><strong>Stages</strong></li>
<li>
<p>Post</p>
</li>
<li>
<p>Update Tags</p>
</li>
<li><strong>Build AS Project</strong></li>
<li>Unit Tests</li>
<li>Deploy</li>
</ul>
<h1 id="stage-build-as-project">Stage: Build AS Project</h1>
<p>Customizing the Jenkinsfile</p>
<p>This stage builds the AS project</p>
<p>A value of -1 for “max_warnings” means you can have infinite warnings. If you optionally specify a positive value here\, the stage will fail if the number of build warnings exceeds this value.</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server29.png" /></p>
<hr />
<p>What if you want to run your pipeline for multiple configurations in the project – how would we do this? 
You would just copy/paste the lines within each Step. So here, copy/paste the BuildASProject line for the additional config. Set this up with them during the initial meeting</p>
<ul>
<li>Variables</li>
<li>Agent</li>
<li>Environment</li>
<li>Options</li>
<li><strong>Stages</strong></li>
<li>
<p>Post</p>
</li>
<li>
<p>Update Tags</p>
</li>
<li>Build AS Project</li>
<li><strong>Unit Tests</strong></li>
<li>Deploy</li>
</ul>
<h1 id="stage-unit-tests">Stage: Unit Tests</h1>
<p>Customizing the Jenkinsfile</p>
<p>This stage runs the automated unit tests</p>
<p>If the pipeline gets stuck on a unit test for longer than 15 minutes\, the tests will fail. Optionally adjust this timeout value as desired.</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server30.png" /></p>
<ul>
<li>Variables</li>
<li>Agent</li>
<li>Environment</li>
<li>Options</li>
<li><strong>Stages</strong></li>
<li>
<p>Post</p>
</li>
<li>
<p>Update Tags</p>
</li>
<li>Build AS Project</li>
<li>Unit Tests</li>
<li><strong>Deploy</strong></li>
</ul>
<h1 id="stage-deploy">Stage: Deploy</h1>
<p>Customizing the Jenkinsfile</p>
<p>The template separates the deploy stage between release branches and feature/develop branches</p>
<p>Therefore\, you can trigger different actions depending on what branch you pushed to</p>
<p>By default\, both stages create the ARsim structure and Project Installation Package</p>
<p>If you want to perform another action in either stage\, add it accordingly</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server31.png" /></p>
<ul>
<li>Variables</li>
<li>Agent</li>
<li>Environment</li>
<li>Options</li>
<li>Stages</li>
<li>
<p><strong>Post</strong></p>
</li>
<li>
<p>Always</p>
</li>
<li>Success</li>
<li>Unstable</li>
</ul>
<h1 id="post">Post</h1>
<p>Customizing the Jenkinsfile</p>
<ul>
<li>The code within Post will always run\, even if a stage in the pipeline fails</li>
<li>Within Post\, there are 3 subsections:</li>
<li><strong>Always</strong>  – runs in every single post processing</li>
<li><strong>Success</strong>  – runs if all unit tests pass</li>
<li>
<p><strong>Unstable</strong>  – runs if any of the unit tests fail. This is classified as “unstable” rather than a failure because the pipeline itself completed\, but the tests did not pass.</p>
</li>
<li>
<p>Variables</p>
</li>
<li>Agent</li>
<li>Environment</li>
<li>Options</li>
<li>Stages</li>
<li>
<p><strong>Post</strong></p>
</li>
<li>
<p><strong>Always</strong></p>
</li>
<li>Success</li>
<li>Unstable</li>
</ul>
<h1 id="post-always">Post: Always</h1>
<p>Customizing the Jenkinsfile</p>
<ul>
<li>The “Always” post script converts the B&amp;R Unit test results into a data format that Jenkins can understand what passed/failed</li>
<li>Archives the ARsim structure and PIP so that they can be used in subsequent pipelines or uploaded to GitHub/Teams</li>
<li>Sends an email with the build status to the EMAIL_LIST recipients</li>
<li>
<p>The PIP that gets automatically generated uses the following installation settings:</p>
<ul>
<li>Consistent installation</li>
<li>Allow updates without data loss</li>
<li>Keep PV values</li>
<li>Ignore version</li>
<li>Always install</li>
</ul>
</li>
<li>
<p>Variables</p>
</li>
<li>Agent</li>
<li>Environment</li>
<li>Options</li>
<li>Stages</li>
<li>
<p><strong>Post</strong></p>
</li>
<li>
<p><strong>Always</strong></p>
</li>
<li>Success</li>
<li>Unstable</li>
</ul>
<h1 id="example-of-a-successful-build-email-notification">Example of a Successful Build Email Notification</h1>
<p>All Tests Passed</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server32.png" /></p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server33.png" /></p>
<ul>
<li>Variables</li>
<li>Agent</li>
<li>Environment</li>
<li>Options</li>
<li>Stages</li>
<li>
<p><strong>Post</strong></p>
</li>
<li>
<p><strong>Always</strong></p>
</li>
<li>Success</li>
<li>Unstable</li>
</ul>
<h1 id="example-of-an-unstable-build-email-notification">Example of an Unstable Build Email Notification</h1>
<p>Some Tests Failed</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server34.png" /></p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server35.png" /></p>
<ul>
<li>Variables</li>
<li>Agent</li>
<li>Environment</li>
<li>Options</li>
<li>Stages</li>
<li>
<p><strong>Post</strong></p>
</li>
<li>
<p>Always</p>
</li>
<li><strong>Success</strong></li>
<li><strong>Unstable</strong></li>
</ul>
<h1 id="post-success-unstable">Post: Success, Unstable</h1>
<p>Customizing the Jenkinsfile</p>
<ul>
<li>Both the “Success” and “Unstable” post scripts do the following:<ul>
<li>Upload the artifacts to GitHub</li>
<li>Send a message to the Teams channel with the status and artifact download links</li>
</ul>
</li>
<li>
<p>The only differences between these post scripts are:</p>
<ul>
<li>The color scheme (green for success\, yellow for unstable)</li>
<li>The text that gets used for the Teams message (“Build Success” vs “Build Unstable”).</li>
</ul>
</li>
<li>
<p>Variables</p>
</li>
<li>Agent</li>
<li>Environment</li>
<li>Options</li>
<li>Stages</li>
<li>
<p><strong>Post</strong></p>
</li>
<li>
<p>Always</p>
</li>
<li><strong>Success</strong></li>
<li><strong>Unstable</strong></li>
</ul>
<h1 id="example-of-ms-teams-messages">Example of MS Teams Messages</h1>
<p>Success vs Unstable</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server36.png" /></p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server37.png" /></p>
<ul>
<li>Variables</li>
<li>Agent</li>
<li>Environment</li>
<li>Options</li>
<li>Stages</li>
<li>
<p><strong>Post</strong></p>
</li>
<li>
<p>Always</p>
</li>
<li><strong>Success</strong></li>
<li><strong>Unstable</strong></li>
</ul>
<h1 id="post-success-unstable_1">Post: Success, Unstable</h1>
<p>Customizing the Jenkinsfile</p>
<ul>
<li>Required steps:</li>
<li>Comment/uncomment the upload lines depending on whether you want to upload the artifacts to GitHub</li>
<li>If you do choose to upload\, make sure you have edited the REPO_NAME and REPO_ORGANIZATION variables at the top of the Jenkinsfile accordingly</li>
</ul>
<p><img alt="" src="../img/Automation%20and%20Build%20Server38.png" /></p>
<h1 id="integration-with-bitbucket">Integration with Bitbucket</h1>
<h1 id="integrate-jenkins-with-bitbucket">Integrate Jenkins with Bitbucket</h1>
<p>How-to</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server39.png" /></p>
<p>From the Bitbucket project\, click on your user icon and select “Manage account”</p>
<p>Select “HTTP access token” in the menu on the left</p>
<p>Click “Create token”</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server40.png" /></p>
<p>How-to</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server41.png" /></p>
<p>Add a token name</p>
<p>Set the Permissions to “Repository read”</p>
<p>Click “Create”</p>
<p>How-to</p>
<p>Make sure to copy the generated token as you will not be able view this again.</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server42.png" /></p>
<p>How-to</p>
<p>Create new project in Jenkins</p>
<p>Enter name of project</p>
<p>Select multibranch pipeline</p>
<p>How-to</p>
<p>Add Credential</p>
<p>Select project name</p>
<p>Add source</p>
<p>Select Bitbucket</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server43.png" /></p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server44.png" /></p>
<p>How-to</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server45.png" /></p>
<p>Change “Kind” to “Username with password”</p>
<p>Paste HTTP access token created from Bitbucket</p>
<p>Give unique ID</p>
<p>How-to</p>
<p>Select new Credential</p>
<p>Set the “Owner” to the Bitbucket project key (4 letter identifier)</p>
<p>Once Owner is entered\, the Repository Name should show up in list</p>
<p>How-to</p>
<p>Then Add “Advanced clone behaviors”</p>
<p>And ensure that “Fetch tags” is checked</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server46.png" /></p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server47.png" /></p>
<p>How-to</p>
<p>After saving\, the repositories will be scanned</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server48.png" /></p>
<h1 id="automated-deployment">Automated Deployment</h1>
<p>DevOps Package</p>
<ul>
<li>Recommendations on automated deployment will be added in a future revision of the B&amp;R DevOps package</li>
<li>For an immediate solution\, consider <a href="https://loupe.team/story/introducing-shuv/">Shuv</a>*</li>
<li>Shuv handles many aspects of the CI/CD process for you\, in addition to automated deployment</li>
<li>Further details on next slide</li>
</ul>
<p><img alt="" src="../img/Automation%20and%20Build%20Server49.png" /></p>
<p>* Note that there is a cost to use Shuv (it is not free)</p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server50.png" /></p>
<p><img alt="" src="../img/Automation%20and%20Build%20Server51.png" /></p>
<p>Tag event + checkout</p>
<p>Manages CI/CD pipelines for your Automation Studio projects and B&amp;R PLCs</p>
<p>Automated pipelines trigger on Git events</p>
<p>Builds simulator and physical PIPs</p>
<p>Runs unit tests and integration tests against the simulator</p>
<p>Integrates with Git to keep track of code versions</p>
<p>Delivers OTA software updates to PLCs that are connected to Shuv via MQTTS</p>
<p>We reserve the right to change the content of this presentation without prior notice. The information contained herein is believed to be accurate as of the date of publication\, however\, B&amp;R makes no warranty\, expressed or implied\, with regards to the products or the documentation contained within this document. B&amp;R shall not be liable in the event if incidental or consequential damages in connection with or arising from the furnishing\, performance or use of these products. The software names\, hardware names and trademarks used in this document are registered by the respective companies.</p>
<p>Copyright © B&amp;R – Subject to change without notice</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.instant.prefetch"], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
    
  </body>
</html>